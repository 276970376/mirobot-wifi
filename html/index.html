<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<title>Mirobot Control</title>
<meta name="viewport" content="width=900, user-scalable=no">
<style>body{background-color:#fff;font-family:sans-serif}a{color:#333}#configure{display:none}#menu li{display:inline-block;list-style-type:none;border:1px solid #888;padding:10px;background-color:#EEE}#menu li a{text-decoration:none;color:#333}#menu li.selected{background-color:#FFF}.editor{display:block;min-width:600px}.editor ol{list-style-type:none;padding:0;margin:0}.editor .left{width:300px;float:left}.editor .functionList{vertical-align:top;background:#EEE;border:1px solid #888;padding:10px}.editor input[type='number']{width:50px}.editor .container h2{background:#888;padding:5px;margin:0;color:#FFF}.editor .right{border:1px solid #888;margin-left:310px;max-width:600px;position:relative}.editor .buttons{position:absolute;padding:0;bottom:0;width:100%}.editor .programWrapper{overflow:auto}.editor .buttons button{color:#FFF;font-size:1.5em;padding:5px;height:40px;vertical-align:top;border:0;width:33.33%;font-weight:bold;margin:0;background:#BBB}.editor .buttons button:focus{outline-width:0}.editor .buttons .run{background-color:#33d121}.editor .buttons .run:hover{background-color:#2cad1d}.editor .buttons .run:active{background-color:#218216}.editor .buttons .stop{background-color:#888}.editor .buttons .stop:hover{background-color:#444}.editor .buttons .stop:active{background-color:#000}.editor .buttons .clear{background-color:#AAA}.editor .buttons .clear:hover{background-color:#777}.editor .buttons .clear:active{background-color:#444}.editor .buttons .disabled{background-color:#BBB}.editor .buttons .disabled:hover{background-color:#BBB}.editor .program{overflow:hidden;min-width:300px;min-height:100%;vertical-align:top;padding:10px}.editor .program .hint{text-align:center;border:1px dashed #888;display:block;padding:10px;min-height:1.5em;color:#CCC}.editor .functionList .hint{display:none}.editor .programWrapper{overflow:auto}.editor .function{background:#FFF;border:1px solid #888;padding:10px;min-height:1.5em}.editor .program .function.running{background:#F00}.editor .functionList .function{-webkit-box-shadow:12px 12px 12px -5px rgba(0,0,0,0.5);-moz-box-shadow:12px 12px 12px -5px rgba(0,0,0,0.5);box-shadow:12px 12px 12px -5px rgba(0,0,0,0.5);margin:0 0 10px}.editor .fn-repeat ol{min-height:1.5em;border:1px solid #888}.editor .dragged{position:absolute;opacity:.5;z-index:2000}.editor .placeholder{position:relative;border:1px dashed #888;display:block;padding:10px;min-height:1.5em}.editor ol.program li.function.active{background-color:#0F0}body.dragging,body.dragging *{cursor:move!important}.connState{position:absolute;right:10px;color:#d12121}.connState.connected{color:#33d121}#miroConnState{top:50px}#wifiConnState{top:25px}#wifiConnState.connected{text-decoration:none}#wifiConnState.connected:hover{text-decoration:underline}#header{padding:10px 0;margin:0 0 10px;border-bottom:1px solid #BBB}.modal{position:absolute;top:0;left:0}.modal{background-color:rgba(0,0,0,0.5);width:100%;height:100%;text-align:center;z-index:100000}.modal .content{background-color:#FFF;width:400px;margin:30px auto;padding:10px;border:5px solid #999;text-align:center}#wifiConfig .content input[type=text],#wifiConfig .content input[type=password]{width:200px}#wifiConfig .content td{text-align:right;padding:4px}#wifiConfig .content td.left{text-align:left}#wifiConfig iframe{width:400px;height:500px;border:0}#version{font-size:75%;color:#CCC;position:absolute;bottom:5px;right:10px}#version a{color:#888}.editor .extra{padding:10px}.editor .extra button{display:block;margin:0 0 10px 0;background:#FFF;border:1px #888 solid;padding:5px;min-width:160px;text-align:center;min-height:3em}.editor .extra button:active{background:#DDD}.editor .extra button:hover{background:#EEE}.editor .extra button:focus{outline:0}#configIframe{border:0;display:hidden;position:absolute;top:0;left:0;width:1px;height:1px}</style>
</head>
<body>
<div id="header">
<img src="logo.png"><a href="#" id="wifiConnState" class="connState"></a><span id="miroConnState" class="connState"></span><span id="version"></span>
</div>
<div id="wifiConfig" class="modal" style="display:none"><div class="content" id="wifiContent"><iframe src="" id="wifiFrame"></iframe></div></div>
<div id="wsMsg" class="modal" style="display:none"><div class="content">
<h3>Your browser does not support Mirobot</h3>
<p>Mirobot uses a feature called WebSockets in order to control it from your browser.</p>
<p>Unfortunately your web browser does not support this.</p>
<p>Any recent version of the major browsers should work without problems. If you're not sure what to use, <a href="https://www.google.com/chrome/browser/">Google Chrome</a> is a good start.</p>
</div></div>
<div id="code"></div>
<script>var wirelessConfig={clientSSID:"%clientSSID%",wifiMode:"%wifiMode%",clientIp:"%clientIp%",clientGateway:"%clientGateway%",clientNetmask:"%clientNetmask%",clientDhcp:"%clientDhcp%",clientMac:"%clientMac%",clientConnected:"%clientConnected%",APAuth:"%APAuth%",APChannel:"%APChannel%",APSSID:"%APSSID%"};wirelessConfig.clientSSID.indexOf("clientSSID")>-1&&(wirelessConfig={clientSSID:"foo",wifiMode:"3",clientIp:"192.168.1.100",clientGateway:"192.168.1.1",clientNetmask:"255.255.255.0",clientDhcp:"true",clientMac:"10:20:30:40:50:60",clientConnected:"true",APAuth:"0",APChannel:"6",APSSID:"Mirobot-abcd"});</script><script type="text/javascript" src="snack.js"></script><script type="text/javascript" src="mirobot.js"></script><script type="text/javascript" src="builder.js"></script><script type="text/javascript" src="snack.sortableList.js"></script><script type="text/javascript">var $,has_remote_conn=!0,remote_base="http://mirobot.io/assets/mirobot_js/",ui_version="201506231008",hashConfig={},mirobot;"{{timestamp}}"===ui_version&&(ui_version="20140723"),""!==window.location.hash&&window.location.hash.replace("#","").split("&").map(function(n){var e=n.split("=");hashConfig[e[0]]=e[1]});var LoadScripts=function(n,e,o){var i=[],t=0,a=function(n,i){loadScript(n[t],i[t],e,function(){t++,t<n.length?a(n,i):o()})};a(n,i)},loadScript=function(n,e,o,i,t){var a,r=!1,s=!1;e=document.createElement("script");var c=function(){r||s||!t||t(),s=!0};e.onerror=c,e.onload=function(){r=!0,delete a,i()},e.src=o+n,document.getElementsByTagName("head")[0].appendChild(e),window.setTimeout(c,3e3)};"undefined"==typeof window.console&&(window.console={log:function(){}});var localApp=function(){console.log("Loading local app"),has_remote_conn=!1;var n,e=void 0,o="unknown",i=function(n){return document.getElementById(n)},t=function(n){i(n).style.display="none",document.body.onkeyup=void 0};updateWirelessConfig=function(n){wirelessConfig=n;var e=i("wifiConnState");"false"===wirelessConfig.clientConnected?(e.innerHTML="&#10007; Configure WiFi",e.className="connState",u(1e4)):(e.innerHTML="&#10003; Connected to WiFi",e.className="connState connected",u(6e4))},window.hideWiFiConfig=function(){t("wifiConfig"),u(1e4)};var a=function(n,e){27===n.which&&t(e)},r=function(n){n.preventDefault(),i("wifiFrame").src="/wifi/index.html",i("wifiConfig").style.display="block",i("wifiContent").onclick=function(n){n.stopPropagation()},i("wifiConfig").onclick=function(){t("wifiConfig"),u()},document.body.onkeyup=function(n){a(n,"wifiConfig"),u()}},s=function(){var n="Firmware version: "+o+" | UI version: "+ui_version;e&&e>ui_version&&(n+=' <a href="http://mirobot.io/build/firmware_update/" target="_blank">Upgrade</a>'),i("version").innerHTML=n},c=function(){mirobot.version(function(n,e){e.msg&&(o=e.msg),s()})},d=function(){if(has_remote_conn){var n=new XMLHttpRequest;n.onreadystatechange=function(){if(4===n.readyState&&200===n.status){for(var o=JSON.parse(n.response),i=0;i<o.length;i++)if(!o[i].prerelease){e=o[i].tag_name;break}s()}},n.open("GET","https://api.github.com/repos/bjpirt/mirobot-ui/releases",!0),n.send()}},f=function(){var n=hashConfig.m||window.location.hostname;mirobot=new Mirobot("ws://"+n+":8899/websocket");var e=(new Builder($("#code"),mirobot),function(n){var e=$("#miroConnState");"connected"===n?("unknown"===o&&window.setTimeout(c,1e3),e[0].innerHTML="&#10003; Connected to Mirobot",e.addClass("connected")):"disconnected"===n&&(e[0].innerHTML="&#10007; Reconnecting to Mirobot",e.removeClass("connected"))});mirobot.addListener(e)},u=function(e){var o=function(){var n=new XMLHttpRequest;n.open("get","/wifi/settings.json",!0),n.onreadystatechange=function(){4==n.readyState&&200==n.status&&updateWirelessConfig(JSON.parse(n.responseText))},n.send()};e?(n&&window.clearTimeout(n),n=window.setTimeout(o,e)):o()};$=snack.wrap,f(),updateWirelessConfig(wirelessConfig),i("wifiConnState").onclick=r,s(),"true"!==hashConfig.l&&"10.10.100.254"!=window.location.hostname&&loadScript("remote.js",void 0,remote_base,function(){has_remote_conn=!0,d()})};"undefined"!=typeof WebSocket?window.addEventListener("load",localApp):document.getElementById("wsMsg").style.display="block";</script>
</body>
</html>
