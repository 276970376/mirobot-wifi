snack.wrap.define("draggableList",function(e){var t,n,a,o,r,s=!1,c=snack.wrap("body"),i=function(e,t,n){e.style.left=t+"px",e.style.top=n+"px"},l=function(e,t,n){var a=n.getBoundingClientRect();return e>=a.left&&e<=a.right&&t>=a.top&&t<=a.bottom},d=function(e,t){if(e===t)return!0;for(;e=e.parentElement;)if(e===t)return!0;return!1},p=function(t){if(!r){var a=document.createElement("div");a.innerHTML=e.placeholder,r=a.childNodes[0]}{var o=snack.wrap(e.target)[0];n.getBoundingClientRect()}if(l(t.pageX,t.pageY,o)){var s=Array.prototype.slice.call(o.getElementsByTagName("li"),0).filter(function(e){return!d(e,n)}),c=s.map(function(e){return[e,Math.abs(t.pageY-e.getBoundingClientRect().top)]}),i=c.reduce(function(e,t){return e[1]<t[1]?e:t});i[0].parentNode.insertBefore(r,i[0]),r.style.height=n.getBoundingClientRect().height-22+"px"}else r&&snack.wrap(r).remove()},u=function(e){e.cancelBubble=!0,e.stopPropagation(),e.preventDefault(),e.returnValue=!1},g=function(t,a){a.handled||(a.handled=!0,snack.each(t.getElementsByTagName("option"),function(e){e.value===e.parentNode.value?e.setAttribute("selected","selected"):e.removeAttribute("selected")}),n=e.copy?t.cloneNode(!0):t,o={x:a.pageX-t.offsetLeft,y:a.pageY-t.offsetTop},n.style.width=t.offsetWidth-22+"px",n.style.height=t.offsetHeight-22+"px",n.style.display="block",n.style.position="absolute",snack.wrap(n).addClass("dragged"),snack.wrap("body").addClass("dragging"),i(n,a.pageX-o.x,a.pageY-o.y),t.parentElement.appendChild(n),p(a),s=!0,u(a))},f=function(t){s&&(i(n,t.pageX-o.x,t.pageY-o.y),p(t),e.ondrag&&e.ondrag(),u(t))},h=function(t){s&&(a&&(a.detach("movers"),a=void 0),s=!1,snack.wrap("body").removeClass("dragging"),snack.wrap(n).removeClass("dragged"),n.parentNode.removeChild(n),r.parentNode&&(r.parentNode.insertBefore(n,r),n._draggable||snack.wrap(n).draggableList({target:e.target,placeholder:'<li class="placeholder"/>',copy:!1})),n.style.width="",n.style.height="",n.style.display="",n.style.position="",snack.wrap(r).remove(),u(t),e.onchange&&e.onchange(),e.copy&&e.onaddelem&&e.onaddelem(n))},m=function(e,n){var o=(e.target||e.srcElement).nodeName.toLowerCase();"select"!==o&&"input"!==o&&("mousedown"===e.type?(a=y(["mouseup","mousemove"],c,"movers"),g(n,e)):"touchstart"===e.type?(t=window.setTimeout(function(){g(n,e)},100),a=y(["touchend","touchmove"],c,"movers")):"touchend"===e.type||"mouseup"===e.type?(t&&clearTimeout(t),h(e)):("touchmove"===e.type||"mousemove"===e.type)&&(t&&clearTimeout(t),f(e)))},y=function(e,t,n){var a,o=snack.wrap(t);return n=n?"."+n:"",snack.each(e,function(e){a=o.attach(e+n,function(e){m(e,t)}),("mousedown"===e||"touchstart"===e)&&snack.each(["select","input"],function(n){for(var a=t.getElementsByTagName(n),o=0;o<a.length;o++)a[o].addEventListener(e,function(e){e.stopPropagation()})})}),a};return this.each(function(e){y(["mousedown","touchstart"],e),e._draggable=!0})});